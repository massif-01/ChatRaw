<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ChatRaw</title>
    <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’¬</text></svg>">
    <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/marked@9.1.6/marked.min.js"></script>
    <script src="https://unpkg.com/highlight.js@11.9.0/lib/highlight.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/highlight.js@11.9.0/styles/github-dark.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=3.2">
</head>
<body x-data="app()" x-init="init()" :data-theme="settings.ui_settings.theme_mode">
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" x-show="!sidebarCollapsed" @click="sidebarCollapsed = true" x-transition:enter="fade-enter" x-transition:leave="fade-leave"></div>
    
    <!-- Sidebar -->
    <aside class="sidebar" :class="{ 'collapsed': sidebarCollapsed }">
        <div class="sidebar-header">
            <div class="logo" x-show="!sidebarCollapsed">
                <img x-show="settings.ui_settings.logo_data" :src="settings.ui_settings.logo_data" alt="Logo" class="logo-img">
                <span class="logo-text" x-text="settings.ui_settings.logo_text || 'JustChat'"></span>
            </div>
            <button class="btn-icon" @click="sidebarCollapsed = !sidebarCollapsed" :title="sidebarCollapsed ? t('expand') : t('collapse')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6" x-show="!sidebarCollapsed"></polyline>
                    <polyline points="9 18 15 12 9 6" x-show="sidebarCollapsed"></polyline>
                </svg>
            </button>
        </div>
        
        <button class="btn-new-chat" @click="createNewChat()" x-show="!sidebarCollapsed">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14"/>
            </svg>
            <span x-text="t('newChat')"></span>
        </button>
        
        <button class="btn-new-chat-collapsed" @click="createNewChat()" x-show="sidebarCollapsed" :title="t('newChat')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14"/>
            </svg>
        </button>

        <div class="chat-list" x-show="!sidebarCollapsed">
            <template x-for="chat in chats" :key="chat.id">
                <div class="chat-item" :class="{ 'active': currentChatId === chat.id }" @click="selectChat(chat.id)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    <span class="chat-title" x-text="chat.title"></span>
                    <button class="btn-delete" @click.stop="deleteChat(chat.id)" :title="t('delete')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </template>
        </div>

        <div class="sidebar-footer" x-show="!sidebarCollapsed">
            <button class="btn-settings" @click="showSettings = true">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                <span x-text="t('settings')"></span>
            </button>
        </div>
        
        <button class="btn-icon sidebar-settings-collapsed" @click="showSettings = true" x-show="sidebarCollapsed" :title="t('settings')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
        </button>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Mobile Header -->
        <div class="mobile-header" x-show="sidebarCollapsed">
            <button class="btn-icon" @click="sidebarCollapsed = false">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <span class="mobile-title">ChatRaw</span>
        </div>

        <div class="chat-container">
            <!-- Welcome -->
            <div class="welcome" x-show="messages.length === 0">
                <div class="welcome-logo">
                    <img x-show="settings.ui_settings.logo_data" :src="settings.ui_settings.logo_data" alt="Logo" class="welcome-logo-img">
                </div>
                <h1 x-text="settings.ui_settings.logo_text || 'JustChat'"></h1>
                <p class="welcome-subtitle" x-text="settings.ui_settings.subtitle || t('defaultSubtitle')"></p>
                
                <div class="welcome-features">
                    <div class="feature">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        <span x-text="t('fastResponse')"></span>
                    </div>
                    <div class="feature">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        <span x-text="t('docRAG')"></span>
                    </div>
                    <div class="feature">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21 15 16 10 5 21"/>
                        </svg>
                        <span x-text="t('visionAI')"></span>
                    </div>
                </div>
            </div>

            <!-- Messages -->
            <div class="messages" x-ref="messagesContainer">
                <template x-for="(msg, index) in messages" :key="index">
                    <div class="message" :class="msg.role">
                        <div class="message-avatar">
                            <template x-if="msg.role === 'user'">
                                <template x-if="settings.ui_settings.user_avatar">
                                    <img :src="settings.ui_settings.user_avatar" alt="User">
                                </template>
                                <template x-if="!settings.ui_settings.user_avatar">
                                    <span>U</span>
                                </template>
                            </template>
                            <template x-if="msg.role === 'assistant'">
                                <template x-if="settings.ui_settings.assistant_avatar">
                                    <img :src="settings.ui_settings.assistant_avatar" alt="AI">
                                </template>
                                <template x-if="!settings.ui_settings.assistant_avatar">
                                    <span>AI</span>
                                </template>
                            </template>
                        </div>
                        <div class="message-content" x-html="renderMarkdown(msg.content)"></div>
                    </div>
                </template>
                
                <div class="message assistant" x-show="isGenerating">
                    <div class="message-avatar"><span>AI</span></div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <span></span><span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container-inner">
                    <div class="uploaded-image-preview" x-show="uploadedImage">
                        <img :src="uploadedImage ? 'data:image/jpeg;base64,' + uploadedImageBase64 : ''" alt="Preview">
                        <button class="btn-delete" @click="removeUploadedImage()" style="opacity:1; position:absolute; top:-10px; right:-10px; background:var(--error-color); color:white; border-radius:50%; width:24px; height:24px; display:flex; align-items:center; justify-content:center;">Ã—</button>
                    </div>

                    <div class="input-wrapper">
                        <textarea 
                            x-model="inputMessage" 
                            @keydown.enter.prevent="if (!$event.shiftKey) sendMessage()"
                            :placeholder="t('inputPlaceholder')"
                            rows="1"
                            x-ref="inputBox"
                            @input="autoResize($refs.inputBox)"
                        ></textarea>
                        
                        <div class="input-toolbar">
                            <div class="rag-toggle" :class="{ 'active': useRAG }" @click="useRAG = !useRAG" :title="t('knowledgeBase')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                                </svg>
                                <div class="rag-slider">
                                    <div class="rag-slider-handle"></div>
                                </div>
                            </div>
                            <label class="btn-tool" :title="t('uploadImage')" style="z-index: 10; position: relative;">
                                <input type="file" @change="handleImageUpload($event)" accept="image/*" style="display: none;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <polyline points="21 15 16 10 5 21"/>
                                </svg>
                            </label>
                        </div>

                        <button class="btn-send" @click="sendMessage()" :disabled="!inputMessage.trim() || isGenerating">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"/>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- New Settings Modal -->
    <div class="modal-overlay" x-show="showSettings" x-cloak @click.self="showSettings = false" x-transition>
        <div class="settings-modal">
            <!-- Left Nav -->
            <div class="settings-nav">
                <div class="settings-title" x-text="t('settings')"></div>
                <div class="nav-item" :class="{ 'active': settingsTab === 'models' }" @click="settingsTab = 'models'" x-text="t('modelConfig')"></div>
                <div class="nav-item" :class="{ 'active': settingsTab === 'chat' }" @click="settingsTab = 'chat'" x-text="t('chatSettings')"></div>
                <div class="nav-item" :class="{ 'active': settingsTab === 'rag' }" @click="settingsTab = 'rag'" x-text="t('ragSettings')"></div>
                <div class="nav-item" :class="{ 'active': settingsTab === 'ui' }" @click="settingsTab = 'ui'" x-text="t('uiSettings')"></div>
                <div class="nav-item" :class="{ 'active': settingsTab === 'docs' }" @click="settingsTab = 'docs'" x-text="t('knowledgeBase')"></div>
                <div class="settings-footer">
                    Â© 2025 ChatRaw by massif-01, RMinte AI Technology Co., Ltd.<br>
                    <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener" style="color: inherit; text-decoration: none; opacity: 0.7;" x-text="t('apacheLicense')"></a>
                </div>
            </div>

            <!-- Right Content -->
            <div class="settings-content">
                <div class="settings-scroll-area">
                    
                    <!-- Models Tab -->
                    <div x-show="settingsTab === 'models'">
                        <div class="section-header">
                            <h2 class="section-title" x-text="t('modelConfig')"></h2>
                            <p class="section-desc" x-text="t('modelConfigDesc')"></p>
                        </div>
                        
                        <template x-for="(model, index) in models" :key="model.id || index">
                            <div class="model-card">
                                <div class="model-header">
                                    <span class="model-badge" x-text="getModelTypeName(model.type)"></span>
                                    <div class="model-status" :class="model.status || 'unknown'">
                                        <span x-show="model.status === 'success'" style="color:var(--success-color)" x-text="'â— ' + t('active')"></span>
                                        <span x-show="model.status === 'error'" style="color:var(--error-color)" x-text="'â— ' + t('error')"></span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">API Endpoint</label>
                                    <input type="text" class="input-minimal" x-model="model.api_url">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">API Key (Optional)</label>
                                    <input type="password" class="input-minimal" x-model="model.api_key">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Model ID</label>
                                    <input type="text" class="input-minimal" x-model="model.model_id">
                                </div>

                                <div class="form-group" x-show="model.type === 'chat'">
                                    <label class="form-label" x-text="t('capabilities')"></label>
                                    <div class="checkbox-group" style="display:flex; gap:20px; margin-top:8px;">
                                        <label style="display:flex; align-items:center; gap:8px; font-size:0.95rem; cursor:pointer;">
                                            <input type="checkbox" x-model="model.capability.vision" style="width:16px; height:16px;"> <span x-text="t('vision')"></span>
                                        </label>
                                        <label style="display:flex; align-items:center; gap:8px; font-size:0.95rem; cursor:pointer;">
                                            <input type="checkbox" x-model="model.capability.reasoning" style="width:16px; height:16px;"> <span x-text="t('reasoning')"></span>
                                        </label>
                                        <label style="display:flex; align-items:center; gap:8px; font-size:0.95rem; cursor:pointer;">
                                            <input type="checkbox" x-model="model.capability.tools" style="width:16px; height:16px;"> <span x-text="t('tools')"></span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group" x-show="model.type === 'chat'">
                                    <label class="form-label" x-text="t('contextLength')"></label>
                                    <input type="number" class="input-minimal" x-model.number="model.context_length" placeholder="8192">
                                </div>

                                <div class="form-group" x-show="model.type === 'chat'">
                                    <label class="form-label" x-text="t('maxOutput')"></label>
                                    <input type="number" class="input-minimal" x-model.number="model.max_output" placeholder="4096">
                                </div>

                                <button class="btn-primary" style="width:100%" @click="saveAndVerifyModel(model, index)" :disabled="model.status === 'loading'">
                                    <span x-text="model.status === 'loading' ? t('verifying') : t('saveAndVerify')"></span>
                                </button>
                                <div x-show="model.verifyMessage" style="margin-top:10px; font-size:0.85rem;" :style="{ color: model.status === 'success' ? 'var(--success-color)' : 'var(--error-color)' }" x-text="model.verifyMessage"></div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- RAG Settings Tab -->
                    <div x-show="settingsTab === 'rag'">
                        <div class="section-header">
                            <h2 class="section-title" x-text="t('ragSettings')"></h2>
                            <p class="section-desc" x-text="t('ragSettingsDesc')"></p>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" x-text="t('chunkSize')"></label>
                            <input type="number" class="input-minimal" x-model.number="settings.rag_settings.chunk_size" placeholder="500">
                            <p class="form-sublabel" x-text="t('chunkSizeHint')"></p>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" x-text="t('chunkOverlap')"></label>
                            <input type="number" class="input-minimal" x-model.number="settings.rag_settings.chunk_overlap" placeholder="50">
                            <p class="form-sublabel" x-text="t('chunkOverlapHint')"></p>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Top K</label>
                            <input type="number" class="input-minimal" x-model.number="settings.rag_settings.top_k" placeholder="3">
                            <p class="form-sublabel" x-text="t('topKHint')"></p>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" x-text="t('scoreThreshold') + ': ' + settings.rag_settings.score_threshold"></label>
                            <input type="range" min="0" max="1" step="0.05" x-model.number="settings.rag_settings.score_threshold">
                            <p class="form-sublabel" x-text="t('scoreThresholdHint')"></p>
                        </div>
                    </div>

                    <!-- Chat Settings Tab -->
                    <div x-show="settingsTab === 'chat'">
                        <div class="section-header">
                            <h2 class="section-title" x-text="t('chatSettings')"></h2>
                            <p class="section-desc" x-text="t('chatSettingsDesc')"></p>
                        </div>

                        <div class="form-group">
                            <div class="toggle-row">
                                <div class="toggle-info">
                                    <label class="form-label" x-text="t('streamOutput')"></label>
                                    <span class="form-sublabel" x-text="t('streamHint')"></span>
                                </div>
                                <div class="toggle-switch" :class="{ 'checked': settings.chat_settings.stream }" @click="settings.chat_settings.stream = !settings.chat_settings.stream">
                                    <div class="toggle-handle"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Temperature: <span x-text="settings.chat_settings.temperature"></span></label>
                            <input type="range" min="0" max="2" step="0.1" x-model.number="settings.chat_settings.temperature">
                            <span class="form-sublabel" style="margin-top:8px;" x-text="t('temperatureHint')"></span>
                        </div>

                        <!-- Top P Slider Restored -->
                        <div class="form-group">
                            <label class="form-label">Top P: <span x-text="settings.chat_settings.top_p"></span></label>
                            <input type="range" min="0" max="1" step="0.05" x-model.number="settings.chat_settings.top_p">
                            <span class="form-sublabel" style="margin-top:8px;" x-text="t('topPHint')"></span>
                        </div>
                    </div>

                    <!-- UI Settings Tab -->
                    <div x-show="settingsTab === 'ui'">
                        <div class="section-header">
                            <h2 class="section-title" x-text="t('uiSettings')"></h2>
                            <p class="section-desc" x-text="t('uiSettingsDesc')"></p>
                        </div>

                        <div class="form-group" style="margin-bottom: 40px;">
                            <label class="form-label" x-text="t('theme')"></label>
                            <div class="theme-grid">
                                <div class="theme-option" :class="{ 'active': settings.ui_settings.theme_mode === 'light' }" @click="settings.ui_settings.theme_mode = 'light'; applyTheme()">
                                    Light
                                </div>
                                <div class="theme-option" :class="{ 'active': settings.ui_settings.theme_mode === 'dark' }" @click="settings.ui_settings.theme_mode = 'dark'; applyTheme()">
                                    Dark
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 40px;">
                            <label class="form-label" x-text="t('language')"></label>
                            <div class="theme-grid">
                                <div class="theme-option" :class="{ 'active': lang === 'en' }" @click="setLanguage('en')">English</div>
                                <div class="theme-option" :class="{ 'active': lang === 'zh' }" @click="setLanguage('zh')">ä¸­æ–‡</div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 40px;">
                            <label class="form-label" x-text="t('logoName')"></label>
                            <div class="logo-upload-area" style="display:flex; align-items:center; gap:12px; flex-wrap:nowrap;">
                                <img x-show="settings.ui_settings.logo_data" :src="settings.ui_settings.logo_data" alt="Logo" class="logo-preview" style="width:48px; height:48px; min-width:48px; border-radius:var(--radius-sm); object-fit:cover; border:1px solid var(--border-color); flex-shrink:0;">
                                <label class="btn-secondary" style="margin:0; white-space:nowrap; flex-shrink:0;">
                                    <input type="file" @change="handleLogoUpload($event)" accept="image/*" style="display: none;">
                                    <span x-text="t('uploadLogo')"></span>
                                </label>
                                <button class="btn-delete" x-show="settings.ui_settings.logo_data" @click="settings.ui_settings.logo_data = ''" style="opacity:1; width:32px; height:32px; border:1px solid var(--border-color); flex-shrink:0;">Ã—</button>
                                <input type="text" x-model="settings.ui_settings.logo_text" placeholder="JustChat" class="input-minimal" style="flex:1; min-width:0;">
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 40px;">
                            <label class="form-label" x-text="t('subtitle')"></label>
                            <input type="text" x-model="settings.ui_settings.subtitle" :placeholder="t('defaultSubtitle')" class="input-minimal">
                        </div>

                        <div class="form-group" style="margin-bottom: 40px;">
                            <label class="form-label" x-text="t('avatars')"></label>
                            
                            <!-- User Avatar Row -->
                            <div style="display:flex; align-items:center; gap:20px; margin-bottom: 16px;">
                                <div class="avatar-preview" style="width:40px; height:40px; border-radius:50%; background:var(--bg-tertiary); overflow:hidden; display:flex; align-items:center; justify-content:center; flex-shrink:0;">
                                    <img x-show="settings.ui_settings.user_avatar" :src="settings.ui_settings.user_avatar" alt="User" style="width:100%; height:100%; object-fit:cover;">
                                    <svg x-show="!settings.ui_settings.user_avatar" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                </div>
                                <label class="btn-secondary" style="margin:0;">
                                    <input type="file" @change="handleAvatarUpload($event, 'user')" accept="image/*" style="display: none;">
                                    <span x-text="t('uploadUserAvatar')"></span>
                                </label>
                            </div>

                            <!-- AI Avatar Row -->
                            <div style="display:flex; align-items:center; gap:20px;">
                                <div class="avatar-preview" style="width:40px; height:40px; border-radius:50%; background:var(--text-primary); color:var(--bg-primary); overflow:hidden; display:flex; align-items:center; justify-content:center; flex-shrink:0;">
                                    <img x-show="settings.ui_settings.assistant_avatar" :src="settings.ui_settings.assistant_avatar" alt="AI" style="width:100%; height:100%; object-fit:cover;">
                                    <span x-show="!settings.ui_settings.assistant_avatar" style="font-weight:bold; font-size:14px;">AI</span>
                                </div>
                                <label class="btn-secondary" style="margin:0;">
                                    <input type="file" @change="handleAvatarUpload($event, 'assistant')" accept="image/*" style="display: none;">
                                    <span x-text="t('uploadAIAvatar')"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Knowledge Base -->
                    <div x-show="settingsTab === 'docs'">
                        <div class="section-header">
                            <h2 class="section-title" x-text="t('knowledgeBase')"></h2>
                            <p class="section-desc" x-text="t('kbDesc')"></p>
                        </div>

                        <div class="upload-area" @click="$refs.fileInput.click()">
                            <input type="file" x-ref="fileInput" @change="handleFileUpload($event)" accept=".txt,.md,.pdf,.doc,.docx" style="display: none;">
                            <div style="font-size:2rem; margin-bottom:10px;">ðŸ“„</div>
                            <div x-text="t('uploadDocument')"></div>
                        </div>
                        
                        <!-- Upload Progress -->
                        <div class="upload-progress" x-show="uploadProgress.show" style="margin-top:20px; padding:16px; background:var(--bg-tertiary); border-radius:var(--radius-sm);">
                            <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:0.85rem;">
                                <span x-text="uploadProgress.filename"></span>
                                <span x-show="uploadProgress.status === 'chunking'">Chunking...</span>
                                <span x-show="uploadProgress.status === 'embedding'" x-text="Math.round(uploadProgress.progress) + '%'"></span>
                            </div>
                            <div style="height:4px; background:var(--bg-hover); border-radius:2px; overflow:hidden;">
                                <div style="height:100%; background:var(--text-primary); transition:width 0.2s;" :style="'width: ' + uploadProgress.progress + '%'"></div>
                            </div>
                        </div>

                        <div class="documents-list" style="margin-top:20px;">
                            <template x-for="doc in documents" :key="doc.id">
                                <div class="nav-item" style="cursor:default; justify-content:space-between;">
                                    <span x-text="doc.filename"></span>
                                    <button class="btn-delete" style="opacity:1;" @click="deleteDocument(doc.id)">Ã—</button>
                                </div>
                            </template>
                            <div x-show="documents.length === 0" style="text-align:center; color:var(--text-muted); padding:20px;" x-text="t('noDocuments')"></div>
                        </div>
                    </div>

                </div>
                
                <!-- Modal Actions Footer -->
                <div class="modal-actions-bar">
                    <button class="btn-secondary" @click="showSettings = false" x-text="t('cancel')"></button>
                    <button class="btn-primary" @click="saveAllSettings()" x-text="t('save')"></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" x-show="toast.show" x-text="toast.message" :class="toast.type" x-transition></div>

    <script src="app.js?v=3.3"></script>
</body>
</html>